import { Button, ComboBox } from "std-widgets.slint";
import { DemoPalette, Page } from "common.slint";

/// Enum representing the available alliance colors
export enum SlintColor {
    Red,
    Blue,
}

/// Struct representing autonomous selection details
export struct Autonomous {
    color: SlintColor,   // Selected alliance color
    index: int,     // Selected autonomous index
    side: string,   // Selected autonomous strategy
}

export global Selector {
    // Callbacks for handling autonomous selection and testing
    callback autonomous(Autonomous);
    callback test();
    // callback image(image);

    in-out property <image> path_image;
}

export component SelectorPage inherits Page {
    // Property to bind the displayed path image
    in-out property<image> path_image <=> path.source;
    // path_image <=> path.source;

    HorizontalLayout {
        spacing: 140px;

        // Vertical layout for autonomous selection controls
        VerticalLayout {
            spacing: 20px;
            padding: 10px;
            width: 50px;

            property<length> button-width: 170px;
            property<length> button-height: 40px;

            // ComboBox for selecting an autonomous mode
            mode_cb := ComboBox {
                width: button-width;
                height: button-height;
                model: [
                    "Select Auton",
                    "Left",
                    "Left other path",
                    "Goal Rush",
                    "Right",
                    "Skills",
                ];
            }

            // Button to toggle alliance color (Red/Blue)
            color_cb := Button {
                width: button-width;
                height: button-height;
                checkable: true;
                text: self.checked ? @tr("blue") : @tr("red");
            }

            // Save button to confirm selection and request path
            Button {
                text: "Save";
                width: button-width;
                height: button-height;
                clicked => {
                    Selector.autonomous({
                        color: color_cb.text == @tr("red") ? SlintColor.Red : SlintColor.Blue,
                        index: mode_cb.current_index,
                        side: mode_cb.current_value,
                    });
                }
            }

            // Test button to trigger the autonomous test
            Button {
                text: "Test Auton";
                width: button-width;                
                height: button-height;
                clicked => {
                    Selector.test();
                }
            }
        }
        
        // Field view with overlayed autonomous path
        Rectangle {
            width: 240px;
            height: 240px;
            
            // Background field image
            Image {
                // source: @image-url("images/home.svg");
                source: @image-url("images/vexu_pb_msf.svg");
                width: 100%;
                height: 100%;
                horizontal-alignment: center;
                vertical-alignment: center;
            }

            // Overlay image for the selected path
            path := Image {
                width: parent.width;
                height: parent.height;
            }
        }
    }
}
