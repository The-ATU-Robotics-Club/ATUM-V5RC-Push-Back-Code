import { Button, ComboBox } from "std-widgets.slint";
import { Page } from "common.slint";

export enum SlintColor {
    Red,
    Blue,
}

/// Struct representing autonomous selection details
export struct Autonomous {
    color: SlintColor, // Selected alliance color
    index: int,        // Selected autonomous index
    side: string,      // Selected autonomous strategy
}

export global Selector {
    // Callbacks for handling autonomous selection and testing
    callback autonomous(Autonomous);
    callback test();
}

export component SelectorPage inherits Page {
    in property <[string]> paths;

    HorizontalLayout {
        spacing: 140px;

        // Vertical layout for autonomous selection controls
        VerticalLayout {
            spacing: 20px;
            padding: 10px;
            width: 50px;

            property<length> button-width: 170px;
            property<length> button-height: 40px;

            // ComboBox for selecting an autonomous mode
            mode_cb := ComboBox {
                width: button-width;
                height: button-height;
                model: root.paths;
            }

            // Button to toggle alliance color (Red/Blue)
            color_cb := Button {
                width: button-width;
                height: button-height;
                checkable: true;
                text: self.checked ? @tr("blue") : @tr("red");
                colorize-icon: false;
            }

            // Save button to confirm selection and request path
            Button {
                text: "Save";
                width: button-width;
                height: button-height;
                clicked => {
                    Selector.autonomous({
                        color: color_cb.text == @tr("red") ? SlintColor.Red : SlintColor.Blue,
                        index: mode_cb.current_index,
                        side: mode_cb.current_value,
                    });
                }
            }

            // Test button to trigger the autonomous test
            Button {
                text: "Test";
                width: button-width;                
                height: button-height;
                clicked => {
                    Selector.test();
                }
            }
        }
    }
}
